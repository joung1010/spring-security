### 기억하기 인증 (Remember-Me) 
"Remember-Me" 기능은 사용자가 로그인할 때, 선택적으로 해당 사용자의 인증 정보를 클라이언트(브라우저) 쪽에 쿠키로 저장하고, 이후 세션이 만료되거나 종료된 후에도 다시 인증하지 않고 접근할 수 있도록 도와줍니다. 이 기능은 사용자가 로그인 폼에서 "Remember Me" 또는 "로그인 상태 유지" 체크박스를 선택하는 방식으로 동작합니다.
  
`UsernamePasswordAuthenticationFilter` 와 함께 사용되며 AbstractAuthenticationProcessingFilter 슈퍼 클래스에서 훅을 통해 구현된다.  
1. 인증 성공시 `RememberService.loginSuccess()` 를 통해 RememberMe 토큰을 생성하고 쿠키로 전달
2. 실패시는 `RememberService.loginFail()` 를 통해 쿠키를 제거
3. LogoutFiler 와 연계해서 로크아웃 시 쿠키 제거

### Remember-Me 기능 구현

Spring Security 에서는 `RememberMeConfigurer`를 통해 쉽게 기억하기 기능을 설정할 수 있습니다. 기본적으로 Spring Security는 "토큰 기반" 또는 "영구 쿠키 기반" 두 가지 Remember-Me 전략을 제공합니다.

### 토큰 기반 Remember-Me 설정

토큰 기반 Remember-Me는 인증된 사용자의 세부 정보를 포함하는 토큰을 생성하여 클라이언트에 쿠키로 저장하고, 이후 요청에서 이 쿠키를 기반으로 사용자를 인증합니다.  
  
기본적으로 암호화된 토큰으로 생성 되어지며 브라우저에 쿠리를 보내고, 향후 세션에서 이 쿠키를 감지하여 작동하여 로그인 하는 방식이다.  
토큰 구성:  
```text
base64(username + ":" + expirationTime + ":" + algorithmName + ":" + algorithmHex(username + ":" + expirationTime + ":" + "password" + ":" + key))
```
- **username** : UserDetailService 로 식별 가능한 사용자 이름
- **password** : 검색된 UserDetailService 에 일치하는 비밀번호
- **expirationTime** : remember-me 토큰이 만료되는 날짜와 기간, 밀리초로 표현
- **key** : remember-me 토큰의 수정을 방지하기 위한 키
- **algorithmName** : 토큰 서명을 생성하고 검증하는데 사용되는 알고리즘(기본적으로 SHA-256 알고리즘 사용)
  
### RememberMeService 구현체
1. **TokenBasedRememberMerService** : 쿠키 기반 토큰의 보안을 위해 해싱을 사용한다.
2. **PersistentTokenBasedRememberMeService** : 생성된 토큰을 저장하기 위해 데이터베이스나 다른 영구 저장 매체를 사용  

두 구현체 모두 **UserDetailsService** 가 필요하다. 

기본 설정은 다음과 같습니다:

```java
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(authz -> authz
                .anyRequest().authenticated()
            )
            .formLogin()
                .permitAll()
            .and()
            .rememberMe(httpRememberMeConfigurer -> httpRememberMeConfigurer
                    .alwaysRemember(true) // 기억하기 매개변수가 설정되지 않았을 떄에도 쿠키가 항상 생성되어야 하는지에 대한 여부
                    .tokenValiditySeconds(86400) // 쿠키의 유효기간을 초 단위로 설정 (예: 24시간)
                    .userDetailsService(userDetailsService()) // 사용자 정보를 제공하는 서비스
                    .rememberMeParameter("remember-me") // 로그인 폼에서 사용할 파라미터 이름 (체크 박스 파라미터 이름)
                    .rememberMeCookieName("remember-me") // 인증을 위한 토큰을 저장하는 쿠키 이름 기본값은 remember-me
                    .key("uniqueAndSecret") // Remember-Me 기능에 사용할 키
            );


        return http.build();
    }

    @Bean
    public UserDetailsService userDetailsService() {
        UserDetails user = User.builder()
            .username("user")
            .password("{noop}password")
            .roles("USER")
            .build();
        return new InMemoryUserDetailsManager(user);
    }
}

```

### Remember-Me 기능 동작 과정

1. **사용자가 로그인 시 "Remember Me" 선택**: 사용자가 로그인 시 "Remember Me" 옵션을 선택하고 로그인하면, 서버는 Remember-Me 쿠키를 생성하여 클라이언트에 전송합니다.
2. **서버가 Remember-Me 쿠키 생성**: 서버는 로그인된 사용자의 세부 정보를 포함하는 쿠키를 생성하고 클라이언트에 저장합니다. 이 쿠키는 암호화되어 저장되며, 설정된 유효 기간 동안 유지됩니다.
3. **세션 만료 또는 종료 후 요청 발생**: 세션이 만료되거나 브라우저가 닫힌 후, 사용자가 다시 애플리케이션에 접근할 때 클라이언트는 Remember-Me 쿠키를 서버로 전송합니다.
4. **서버가 쿠키를 검증**: 서버는 쿠키를 검증하고, 유효한 경우 사용자를 자동으로 인증합니다. 이 과정에서 세션이 다시 생성되고 사용자가 로그인된 상태로 유지됩니다.
5. **기억하기 기능 활성화**: Remember-Me 기능이 활성화되면, 사용자는 새로 로그인할 필요 없이 계속해서 애플리케이션에 접근할 수 있습니다.

### 보안 고려사항

Remember-Me 기능은 사용자 경험을 개선할 수 있지만, 보안에 주의가 필요합니다:

- **쿠키 탈취 위험**: Remember-Me 쿠키가 탈취되면, 공격자가 해당 쿠키를 이용해 사용자를 가장할 수 있습니다. 이를 방지하기 위해 HTTPS를 사용하고, 쿠키에 `HttpOnly`와 `Secure` 플래그를 설정하는 것이 좋습니다.
- **비밀 키 관리**: Remember-Me 기능에 사용하는 키는 외부에 노출되지 않도록 안전하게 관리해야 합니다. 키가 노출되면 공격자가 토큰을 임의로 생성할 수 있습니다.
- **세션 타임아웃**: Remember-Me 기능을 사용할 때도 세션 타임아웃 설정은 유지해야 하며, 중요한 리소스에 접근할 때는 재인증을 요구하는 것이 좋습니다.

이렇게 Remember-Me 기능을 적절히 활용하면 사용자가 더 편리하게 애플리케이션을 이용할 수 있으며, 보안 수준도 유지할 수 있습니다.